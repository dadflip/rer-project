services:
  dns-node:
    build: ./dns
    env_file:
      - ./dns-dhcp.univ.env
      - ./dns-dhcp.local.env
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      TZ: ${TZ}
    volumes:
      - ./dns/config:/etc/dnsmasq.d
    command: >
      bash -c "dnsmasq -k --conf-file=/etc/dnsmasq.d/dnsmasq.conf"
    restart: unless-stopped
    networks:
      lan-local:
        ipv4_address: ${IP_DNS_NODE}

  dhcp-node:
    build: ./dhcp
    env_file:
      - ./dns-dhcp.univ.env
      - ./dns-dhcp.local.env
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      TZ: ${TZ}
    volumes:
      - ./dhcp/config:/etc/dnsmasq.d
    command: >
      bash -c "dnsmasq -k --conf-file=/etc/dnsmasq.d/dnsmasq.conf"
    restart: unless-stopped
    networks:
      lan-local:
        ipv4_address: ${IP_DHCP_NODE}

    # network_mode: host   # utilise directement le réseau de l'hôte

networks:
  lan-local:
    external: true
    name: ${LAN_NETWORK_NAME:-lan-local}
